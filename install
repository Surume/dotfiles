#!/bin/bash
# =========================
# spacemacs
# =========================
echo "Install spacemacs"
if [ ! -e ~/.spacemacs ]; then rm -rf ~/.emacs.d; git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d; fi

rm -rf ~/.emacs.d/private
echo "`pwd`/private ->  ~/.emacs.d/private"
ln -s `pwd`/private ~/.emacs.d/private


# =========================
# Antigen & prezto
# =========================
echo "Install antigen & prezto"
if [ ! -e ./antigen ]; then
    # Antigen を導入
    git clone https://github.com/zsh-users/antigen.git;
    source ./antigen/antigen.zsh

    # Antigen から Prezto を導入
    antigen bundle sorin-ionescu/prezto

    # Prezto から参照させるため、シンボリックリンクを設置
    ln -s ~/.antigen/repos/.zprezto ~/.zprezto

    # Prezto の Zsh 設定ファイルへのシンボリックリンクを設置
    setopt EXTENDED_GLOB
    for rcfile in "${ZDOTDIR:-$HOME}/.zprezto/runcoms/^README.md(.N)"; do
        if ! [ rcfile = "${ZDOTDIR:-$HOME}/.zshrc"]; then
            ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
        fi
    done
fi

copy_file () {
    if [ ! -e ~/$1 ]; then
        cp -rf `pwd`/$1 ~
    fi
}
export -f copy_file

link_file () {
    if [ ! -e ~/$1 ]; then
        ln -s `pwd`/$1 ~
    fi
}
export -f link_file

ls -A | grep -v _local | grep -vwe default-gems -vwe README -e install -e private -e "line_hidden.sh" -e ".git" -e ".gitmodules" | xargs -I{} bash -c "link_file {}"


ls -A | grep _local | xargs -I{} bash -c "copy_file {}"

# cd `pwd`/.zprezto/modules/prompt/functions/
# rm -f prompt_agnoster_setup prompt_powerline_setup prompt_pure_setup
